<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{fragments/layout :: layout(~{::content}, 'Quản lý Lịch làm việc')}"
>
  <div th:fragment="content">
    <h2 class="mb-4">
      Quản lý Lịch làm việc cho Bác sĩ:
      <span th:text="${doctor.user.fullName}"></span>
    </h2>

    <div
      th:if="${successMessage}"
      class="alert alert-success"
      th:text="${successMessage}"
    ></div>
    <div
      th:if="${errorMessage}"
      class="alert alert-danger"
      th:text="${errorMessage}"
    ></div>

    <div class="row">
      <div class="col-md-7">
        <h4>Lịch làm việc hiện tại</h4>
        <div th:if="${#lists.isEmpty(schedules)}" class="alert alert-info">
          Bác sĩ này chưa có lịch làm việc nào.
        </div>
        <table
          class="table table-striped table-hover"
          th:unless="${#lists.isEmpty(schedules)}"
        >
          <thead class="table-dark">
            <tr>
              <th>Thứ</th>
              <th>Ca làm việc</th>
              <th>Thời gian</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="sch : ${schedules}">
              <td th:text="${dayOfWeekTranslations[sch.dayOfWeek]}"></td>
              <td th:text="${sch.session}"></td>
              <td
                th:text="${#temporals.format(sch.startTime, 'HH:mm')} + ' - ' + ${#temporals.format(sch.endTime, 'HH:mm')}"
              ></td>
              <td>
                <form
                  th:action="@{/admin/doctors/{doctorId}/schedules/{scheduleId}/delete(doctorId=${doctor.id}, scheduleId=${sch.id})}"
                  method="post"
                  onsubmit="return confirm('Bạn có chắc muốn xóa lịch này?')"
                >
                  <button type="submit" class="btn btn-sm btn-danger">
                    Xóa
                  </button>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="col-md-5">
        <h4>Thêm ca làm việc mới</h4>
        <div class="card">
          <div class="card-body">
            <form
              th:action="@{/admin/doctors/{doctorId}/schedules/add(doctorId=${doctor.id})}"
              th:object="${newSchedule}"
              method="post"
            >
              <div class="mb-3">
                <label for="dayOfWeek" class="form-label"
                  >Chọn ngày trong tuần</label
                >
                <select
                  th:field="*{dayOfWeek}"
                  id="dayOfWeek"
                  class="form-select"
                  required
                >
                  <option value="">-- Chọn ngày --</option>
                  <option
                    th:each="dayEntry : ${dayOfWeekTranslations}"
                    th:value="${dayEntry.key}"
                    th:text="${dayEntry.value}"
                  ></option>
                </select>
              </div>

              <div class="mb-3">
                <label for="session" class="form-label">Chọn ca làm việc</label>
                <select
                  th:field="*{session}"
                  id="session"
                  class="form-select"
                  required
                >
                  <option value="">-- Chọn ca --</option>
                  <option
                    th:each="ws : ${T(vn.hcm.nhidong2.clinicbookingapi.models.WorkingSession).values()}"
                    th:value="${ws}"
                    th:text="${ws.name()} + ' (' + ${#temporals.format(ws.getStartTime(), 'HH:mm')} + ' - ' + ${#temporals.format(ws.getEndTime(), 'HH:mm')} + ')'"
                  ></option>
                </select>
                <small class="form-text text-muted"
                  >Hệ thống sẽ tự động gán giờ Bắt đầu và Kết thúc.</small
                >
              </div>

              <button type="submit" class="btn btn-primary">Thêm Lịch</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <a th:href="@{/admin/doctors}" class="btn btn-secondary mt-4"
      >Quay lại danh sách Bác sĩ</a
    >
  </div>
</html>
