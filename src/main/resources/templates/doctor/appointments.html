<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{fragments/layout :: layout(~{::content}, 'Lịch hẹn của tôi')}"
>
  <div th:fragment="content">
    <h2 class="mb-4">Danh sách lịch hẹn của tôi</h2>
    <div th:if="${#lists.isEmpty(appointments)}" class="alert alert-info">
      Bạn không có lịch hẹn nào.
    </div>
    <table
      class="table table-striped table-hover"
      th:unless="${#lists.isEmpty(appointments)}"
    >
      <thead class="table-dark">
        <tr>
          <th>Bệnh nhân</th>
          <th>Thời gian hẹn</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="appt : ${appointments}">
          <td th:text="${appt.patientFullName}"></td>
          <td th:text="${appt.formattedTime}"></td>
          <td>
            <span th:switch="${appt.status}">
              <span
                th:case="'PENDING'"
                class="badge text-bg-warning"
                th:text="${appt.translatedStatus}"
              ></span>
              <span
                th:case="'PAID_PENDING'"
                class="badge text-bg-warning"
                th:text="${appt.translatedStatus}"
              ></span>
              <span
                th:case="'CONFIRMED'"
                class="badge text-bg-primary"
                th:text="${appt.translatedStatus}"
              ></span>
              <span
                th:case="'COMPLETED'"
                class="badge text-bg-success"
                th:text="${appt.translatedStatus}"
              ></span>
              <span
                th:case="'CANCELLED'"
                class="badge text-bg-danger"
                th:text="${appt.translatedStatus}"
              ></span>
            </span>
          </td>
          <td>
            <a
              th:href="@{/doctor/appointments/{id}(id=${appt.id})}"
              class="btn btn-sm btn-info"
              >Chi tiết</a
            >

            <form
              th:if="${appt.status == 'PENDING'}"
              th:action="@{/doctor/appointments/{id}/confirm(id=${appt.id})}"
              method="post"
              class="d-inline"
            >
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <button type="submit" class="btn btn-sm btn-success">
                Xác nhận
              </button>
            </form>

            <form
              th:if="${appt.status == 'CONFIRMED'}"
              th:action="@{/doctor/appointments/{id}/remind(id=${appt.id})}"
              method="post"
              class="d-none d-md-inline"
            >
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <button type="submit" class="btn btn-sm btn-danger" data-bs-toggle="tooltip" title="Gửi nhắc lịch">
                Gửi nhắc
              </button>
            </form>
            <a
              th:href="@{/doctor/appointments/{id}/record/create(id=${appt.id})}"
              class="btn btn-sm btn-primary"
              th:if="${appt.status == 'CONFIRMED'}"
              >Tạo bệnh án</a
            >
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</html>
